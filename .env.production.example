# Production Environment Configuration
# Copy this to .env.production and fill in actual values
# CRITICAL: DO NOT commit actual secrets to version control
# Use Docker Secrets, HashiCorp Vault, or Kubernetes Secrets for production

# ============================================================================
# ENVIRONMENT
# ============================================================================
NODE_ENV=production

# ============================================================================
# SERVER
# ============================================================================
PORT=4000
HOST=0.0.0.0

# URLs
API_URL=https://api.syncwatch.example
WS_URL=wss://api.syncwatch.example
FRONTEND_URL=https://syncwatch.example

# ============================================================================
# DATABASE (PostgreSQL)
# ============================================================================
# CRITICAL: Use Docker Secrets in production
# DO NOT set DATABASE_URL directly - use DATABASE_URL_FILE instead
DATABASE_URL_FILE=/run/secrets/database_url

# Database credentials (for service configuration only)
POSTGRES_USER=syncwatch_prod
POSTGRES_DB=syncwatch_prod
# NEVER set POSTGRES_PASSWORD directly - use secrets

# ============================================================================
# REDIS
# ============================================================================
# CRITICAL: Use Docker Secrets in production
REDIS_URL_FILE=/run/secrets/redis_url

# Redis configuration
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DATABASE=0
# NEVER set REDIS_PASSWORD directly - use secrets

# ============================================================================
# MINIO / S3 STORAGE
# ============================================================================
# CRITICAL: Use Docker Secrets in production
MINIO_ACCESS_KEY_FILE=/run/secrets/minio_access_key
MINIO_SECRET_KEY_FILE=/run/secrets/minio_secret_key

# Storage configuration
MINIO_ENDPOINT=s3.amazonaws.com  # Or your MinIO endpoint
MINIO_PORT=443
MINIO_USE_SSL=true
MINIO_BUCKET=syncwatch-prod
MINIO_REGION=us-east-1

# ============================================================================
# JWT & AUTHENTICATION
# ============================================================================
# CRITICAL: Use Docker Secrets in production
# JWT secrets must be strong random values (minimum 32 characters)
JWT_SECRET_FILE=/run/secrets/jwt_secret
JWT_REFRESH_SECRET_FILE=/run/secrets/jwt_refresh_secret

JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# ============================================================================
# TURN / STUN SERVER (WebRTC)
# ============================================================================
# CRITICAL: Use Docker Secrets in production
TURN_SECRET_FILE=/run/secrets/turn_secret

# TURN server configuration
TURN_SERVER_URL=turn:turn.syncwatch.example:3478
TURN_SERVER_URL_BACKUP=turn:turn-backup.syncwatch.example:3478
TURN_CREDENTIAL_TTL=86400

# ============================================================================
# CORS
# ============================================================================
# Comma-separated list of allowed origins
CORS_ORIGINS=https://syncwatch.example,https://www.syncwatch.example

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000

# ============================================================================
# VIDEO SETTINGS
# ============================================================================
MAX_UPLOAD_SIZE_MB=8192
MAX_VIDEO_DURATION_HOURS=3
VIDEO_EXPIRY_HOURS=72
MAX_ROOM_PARTICIPANTS=5

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================
WORKER_CONCURRENCY=4
WORKER_MEMORY_LIMIT=8g

# ============================================================================
# OBSERVABILITY
# ============================================================================
LOG_LEVEL=warn
ENABLE_METRICS=true
ENABLE_TRACING=true

# ============================================================================
# EXTERNAL SERVICES
# ============================================================================
# Sentry error tracking
# CRITICAL: Use Docker Secrets for DSN
SENTRY_DSN_FILE=/run/secrets/sentry_dsn

# ============================================================================
# DOCKER REGISTRY
# ============================================================================
DOCKER_REGISTRY=ghcr.io/visagedvachevsky
VERSION=latest

# ============================================================================
# SECURITY NOTES
# ============================================================================
#
# SECRET ROTATION SCHEDULE:
# - Database passwords: Every 90 days
# - JWT secrets: Every 30 days
# - Storage credentials: Every 90 days
# - TURN secret: Every 7 days
# - External tokens: As needed or annually
#
# CREATING DOCKER SECRETS:
#
# 1. Generate secure secrets:
#    openssl rand -base64 32
#
# 2. Create Docker secrets:
#    echo "your_secret_value" | docker secret create database_url -
#    echo "your_secret_value" | docker secret create jwt_secret -
#    echo "your_secret_value" | docker secret create jwt_refresh_secret -
#    echo "your_secret_value" | docker secret create minio_access_key -
#    echo "your_secret_value" | docker secret create minio_secret_key -
#    echo "your_secret_value" | docker secret create turn_secret -
#    echo "your_secret_value" | docker secret create sentry_dsn -
#    echo "your_secret_value" | docker secret create redis_url -
#
# 3. Verify secrets:
#    docker secret ls
#
# AUDIT TRAIL:
# All secret access is logged for security auditing.
# Review logs regularly for unauthorized access attempts.
#
# ============================================================================
